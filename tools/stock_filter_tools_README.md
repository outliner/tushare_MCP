# 股票筛选工具使用说明

## 工具概述

本模块提供了两个 MCP Tool，用于股票数据收集和筛选：

1. **collect_stock_data** - 数据收集工具
2. **filter_stocks** - 股票筛选工具

## 工具1: collect_stock_data

### 功能
收集股票数据到 `t1_data` 表，为后续筛选提供基准数据。

### 参数
- `trade_date` (str, 可选): 目标交易日（T日），格式：YYYYMMDD，如：20251219
  - 如果为空且 `auto_detect=True`，则自动使用最近交易日
- `auto_detect` (bool, 默认True): 是否自动检测最近交易日

### 说明
- 收集的是 **T-1 日**的数据作为基准数据
- 数据包括：
  - 每日指标（市值、流通股本等）
  - 日线行情（收盘价、成交量等）
  - 筹码数据（胜率、集中度等）
  - 融资融券数据
  - 龙虎榜数据（机构净买入、上榜次数等）
- 数据会保存到 `t1_data` 表中，供后续筛选使用

### 使用示例
```
collect_stock_data(trade_date="20251219")
# 或自动检测最近交易日
collect_stock_data(auto_detect=True)
```

## 工具2: filter_stocks

### 功能
基于策略上下文的多模式股票筛选，支持熊市、震荡市、牛市三种市场风格。

### 参数
- `trade_date` (str, 可选): 目标交易日（T日），格式：YYYYMMDD，如：20251219
  - 如果为空且 `auto_detect=True`，则自动使用最近交易日
- `regime` (int, 默认1): 市场风格模式
  - `0`: 熊市模式（极度保守，涨幅0%~2.5%）
  - `1`: 震荡市模式（防御潜伏，涨幅0.5%~4.2%，默认）
  - `2`: 牛市模式（进攻型，涨幅3%~8.5%）
- `top_n` (int, 默认9): 输出前N只股票
- `auto_detect` (bool, 默认True): 是否自动检测最近交易日

### 筛选逻辑
根据市场风格自动调整筛选参数：

#### 震荡市模式 (regime=1, 默认)
- **涨幅区间**: 0.5% ~ 4.2%（拒绝追高，吃鱼身不吃鱼尾）
- **VWAP偏离度**: -0.2% ~ 1.5%（成本控制，允许微弱负溢价）
- **换手率上限**: 8%（拒绝过热）
- **大单异动**: > 1.3（主力必须在场）

#### 牛市模式 (regime=2)
- **涨幅区间**: 3% ~ 8.5%（追涨模式）
- **大单异动**: > 1.2（跟随主力资金）

#### 熊市模式 (regime=0)
- **涨幅区间**: 0% ~ 2.5%（极度保守）
- **大单异动**: > 1.5（要求更高）

### 筛选流程
1. **初步漏斗筛选**: 涨幅、VWAP偏离度、换手率等硬性条件
2. **自适应风控**: 根据市值分层设置换手率上限
3. **筹码分级**: 根据胜率和集中度分为 Tier1/Tier2
4. **量化评分**: 综合效率、胜率、大单异动等指标
5. **最终选股**: 优先 Tier1，按综合得分排序

### 使用示例
```
# 震荡市模式筛选（默认）
filter_stocks(trade_date="20251219", regime=1, top_n=9)

# 牛市模式筛选
filter_stocks(trade_date="20251219", regime=2, top_n=9)

# 自动检测日期，震荡市模式
filter_stocks(regime=1, auto_detect=True)
```

## 使用流程

### 完整工作流程
1. **第一步**: 使用 `collect_stock_data` 收集 T-1 日数据
   ```
   collect_stock_data(trade_date="20251219")
   ```

2. **第二步**: 使用 `filter_stocks` 进行筛选
   ```
   filter_stocks(trade_date="20251219", regime=1, top_n=9)
   ```

### 注意事项
- 筛选前必须先收集数据，否则会提示数据不存在
- 如果数据已存在，`collect_stock_data` 会提示，不会重复采集
- 日期格式必须为 YYYYMMDD（8位数字）
- 市场风格参数 `regime` 必须为 0、1 或 2

## 输出说明

### collect_stock_data 输出
- 采集完成提示
- 记录总数
- 数据完整性统计（基础数据、筹码数据、机构数据、融资融券数据的覆盖率）

### filter_stocks 输出
- 市场风格和参数说明
- 筛选结果表格，包含：
  - 股票代码
  - 涨幅%
  - 换手率%
  - VWAP偏离
  - 大单异动
  - 胜率%
  - 筹码Tier
  - 综合得分
- 筛选说明（根据市场风格）

