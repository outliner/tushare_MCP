# å›½é™…æŒ‡æ•°æ•°æ®è¡¨è®¾è®¡æ–‡æ¡£

## ğŸ“Š è¡¨ç»“æ„

### è¡¨åï¼š`global_index_data`

åŸºäº Tushare `index_global` æ¥å£çš„æ•°æ®æ ¼å¼è®¾è®¡ï¼Œç›´æ¥æ˜ å°„æ¥å£è¿”å›çš„æ‰€æœ‰å­—æ®µã€‚

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | æ˜¯å¦å¯ç©º |
|--------|------|------|---------|
| `ts_code` | TEXT | TSæŒ‡æ•°ä»£ç ï¼ˆå¦‚ï¼šXIN9ã€HSIã€DJIç­‰ï¼‰ | NOT NULL |
| `trade_date` | TEXT | äº¤æ˜“æ—¥æœŸï¼ˆYYYYMMDDæ ¼å¼ï¼Œå¦‚ï¼š20241201ï¼‰ | NOT NULL |
| `open` | REAL | å¼€ç›˜ç‚¹ä½ | NULL |
| `close` | REAL | æ”¶ç›˜ç‚¹ä½ | NULL |
| `high` | REAL | æœ€é«˜ç‚¹ä½ | NULL |
| `low` | REAL | æœ€ä½ç‚¹ä½ | NULL |
| `pre_close` | REAL | æ˜¨æ—¥æ”¶ç›˜ç‚¹ | NULL |
| `change` | REAL | æ¶¨è·Œç‚¹ä½ | NULL |
| `pct_chg` | REAL | æ¶¨è·Œå¹…ï¼ˆç™¾åˆ†æ¯”ï¼‰ | NULL |
| `swing` | REAL | æŒ¯å¹…ï¼ˆç™¾åˆ†æ¯”ï¼‰ | NULL |
| `vol` | REAL | æˆäº¤é‡ï¼ˆå¤§éƒ¨åˆ†æŒ‡æ•°æ— æ­¤é¡¹æ•°æ®ï¼‰ | NULL |
| `amount` | REAL | æˆäº¤é¢ï¼ˆå¤§éƒ¨åˆ†æŒ‡æ•°æ— æ­¤é¡¹æ•°æ®ï¼‰ | NULL |
| `created_at` | REAL | æ•°æ®åˆ›å»ºæ—¶é—´æˆ³ | NOT NULL |

### ä¸»é”®

- **å¤åˆä¸»é”®**ï¼š`(ts_code, trade_date)`
- ç¡®ä¿åŒä¸€æŒ‡æ•°çš„åŒä¸€å¤©åªæœ‰ä¸€æ¡æ•°æ®
- ä½¿ç”¨ `INSERT OR REPLACE` å®ç°æ•°æ®å»é‡å’Œæ›´æ–°

### ç´¢å¼•

ä¸ºäº†æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œåˆ›å»ºäº†ä»¥ä¸‹ç´¢å¼•ï¼š

1. **idx_ts_code**ï¼š`ts_code` å•åˆ—ç´¢å¼•
   - ç”¨äºæŒ‰æŒ‡æ•°ä»£ç æŸ¥è¯¢

2. **idx_trade_date**ï¼š`trade_date` å•åˆ—ç´¢å¼•
   - ç”¨äºæŒ‰æ—¥æœŸæŸ¥è¯¢

3. **idx_ts_code_date**ï¼š`(ts_code, trade_date)` å¤åˆç´¢å¼•
   - ç”¨äºæŒ‰æŒ‡æ•°ä»£ç å’Œæ—¥æœŸç»„åˆæŸ¥è¯¢ï¼ˆè¦†ç›–ä¸»é”®æŸ¥è¯¢ï¼‰

4. **idx_created_at**ï¼š`created_at` å•åˆ—ç´¢å¼•
   - ç”¨äºæŒ‰åˆ›å»ºæ—¶é—´æŸ¥è¯¢å’Œç»Ÿè®¡

## ğŸ”„ ç¼“å­˜ç­–ç•¥

### æ°¸ä¸å¤±æ•ˆç­–ç•¥

1. **æ•°æ®æ°¸ä¹…ä¿å­˜**
   - æ‰€æœ‰æŒ‡æ•°æ•°æ®æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­
   - ä¸è®¾ç½®è¿‡æœŸæ—¶é—´
   - ä¸è¿›è¡Œè‡ªåŠ¨æ¸…ç†

2. **æ•°æ®å»é‡æœºåˆ¶**
   - ä½¿ç”¨ `INSERT OR REPLACE` ç¡®ä¿æ•°æ®å”¯ä¸€æ€§
   - å¦‚æœåŒä¸€æŒ‡æ•°çš„åŒä¸€å¤©æ•°æ®å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°ä¸ºæ–°æ•°æ®
   - ä¿ç•™ `created_at` æ—¶é—´æˆ³è®°å½•æ•°æ®åˆ›å»ºæ—¶é—´

3. **æŸ¥è¯¢é€»è¾‘**
   - ä¼˜å…ˆä»æ•°æ®åº“æŸ¥è¯¢
   - å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰æ•°æ®ï¼Œæ‰ä» Tushare API è·å–
   - è·å–åç«‹å³ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¾›åç»­æŸ¥è¯¢ä½¿ç”¨

4. **æ•°æ®æ›´æ–°**
   - å¦‚æœ API è¿”å›çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ç›¸åŒï¼ˆåŒä¸€æŒ‡æ•°ã€åŒä¸€æ—¥æœŸï¼‰ï¼Œåˆ™è‡ªåŠ¨æ›´æ–°
   - ä¸ä¼šåˆ›å»ºé‡å¤è®°å½•

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### Python ä»£ç ç¤ºä¾‹

```python
from cache.index_cache_manager import index_cache_manager

# ä¿å­˜æŒ‡æ•°æ•°æ®
df = pro.index_global(ts_code='XIN9', start_date='20240101', end_date='20241231')
saved_count = index_cache_manager.save_index_data(df)
print(f"ä¿å­˜äº† {saved_count} æ¡è®°å½•")

# æŸ¥è¯¢ç‰¹å®šæ—¥æœŸçš„æ•°æ®
df = index_cache_manager.get_index_data(
    ts_code='XIN9',
    trade_date='20241201'
)

# æŸ¥è¯¢æ—¥æœŸèŒƒå›´çš„æ•°æ®
df = index_cache_manager.get_index_data(
    ts_code='XIN9',
    start_date='20240101',
    end_date='20241231'
)

# æŸ¥è¯¢æœ€è¿‘10æ¡æ•°æ®
df = index_cache_manager.get_index_data(
    ts_code='XIN9',
    limit=10,
    order_by='DESC'
)

# æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
has_data = index_cache_manager.has_data('XIN9', '20241201')

# è·å–æ•°æ®æ—¥æœŸèŒƒå›´
date_range = index_cache_manager.get_date_range('XIN9')
# è¿”å›: {'start_date': '20240101', 'end_date': '20241231'}

# è·å–ç»Ÿè®¡ä¿¡æ¯
stats = index_cache_manager.get_stats()
```

## ğŸ” SQL æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢ç‰¹å®šæŒ‡æ•°çš„æ‰€æœ‰æ•°æ®

```sql
SELECT * FROM global_index_data
WHERE ts_code = 'XIN9'
ORDER BY trade_date DESC;
```

### æŸ¥è¯¢ç‰¹å®šæ—¥æœŸçš„æ‰€æœ‰æŒ‡æ•°æ•°æ®

```sql
SELECT * FROM global_index_data
WHERE trade_date = '20241201'
ORDER BY ts_code;
```

### æŸ¥è¯¢æ—¥æœŸèŒƒå›´å†…çš„æ•°æ®

```sql
SELECT * FROM global_index_data
WHERE ts_code = 'XIN9'
  AND trade_date >= '20240101'
  AND trade_date <= '20241231'
ORDER BY trade_date DESC;
```

### ç»Ÿè®¡æ¯ä¸ªæŒ‡æ•°çš„æ•°æ®é‡

```sql
SELECT 
    ts_code,
    COUNT(*) as record_count,
    MIN(trade_date) as earliest_date,
    MAX(trade_date) as latest_date
FROM global_index_data
GROUP BY ts_code
ORDER BY ts_code;
```

## ğŸ¯ ä¼˜åŠ¿

1. **æ€§èƒ½ä¼˜åŒ–**
   - ç›´æ¥å­˜å‚¨å­—æ®µï¼Œæ— éœ€ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
   - ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
   - æ”¯æŒé«˜æ•ˆçš„æ—¥æœŸèŒƒå›´æŸ¥è¯¢

2. **æ•°æ®å®Œæ•´æ€§**
   - ä¸»é”®çº¦æŸç¡®ä¿æ•°æ®å”¯ä¸€æ€§
   - æ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œä¸ä¼šä¸¢å¤±
   - æ”¯æŒå†å²æ•°æ®æŸ¥è¯¢

3. **çµæ´»æ€§**
   - æ”¯æŒæŒ‰æŒ‡æ•°ä»£ç ã€æ—¥æœŸã€æ—¥æœŸèŒƒå›´æŸ¥è¯¢
   - æ”¯æŒæ’åºå’Œé™åˆ¶è¿”å›æ•°é‡
   - æ”¯æŒç»Ÿè®¡å’Œæ•°æ®åˆ†æ

4. **ç»´æŠ¤ç®€å•**
   - è¡¨ç»“æ„æ¸…æ™°ï¼Œå­—æ®µç›´æ¥æ˜ å°„ API è¿”å›æ•°æ®
   - æ— éœ€å¤æ‚çš„ç¼“å­˜è¿‡æœŸç®¡ç†
   - æ•°æ®è‡ªåŠ¨å»é‡å’Œæ›´æ–°

## ğŸ“Š æ•°æ®é‡ä¼°ç®—

å‡è®¾ï¼š
- æ”¯æŒ 22 ä¸ªå›½é™…æŒ‡æ•°
- æ¯ä¸ªæŒ‡æ•°æ¯å¹´çº¦ 250 ä¸ªäº¤æ˜“æ—¥
- æ¯æ¡è®°å½•çº¦ 200 å­—èŠ‚

**å¹´æ•°æ®é‡**ï¼š22 Ã— 250 Ã— 200 å­—èŠ‚ â‰ˆ 1.1 MB/å¹´

**10å¹´æ•°æ®é‡**ï¼šçº¦ 11 MB

æ•°æ®é‡å¾ˆå°ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ SQLite å­˜å‚¨ï¼Œæ— éœ€æ‹…å¿ƒæ€§èƒ½é—®é¢˜ã€‚

